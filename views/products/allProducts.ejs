<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Our Products</title>
    <link rel="stylesheet" href="/styling/allProducts.css" />
  </head>
  <body>
    <%- include('../partials/header.ejs') %>
    <h1>Fresh & Organic Products</h1>

    <!-- üîç Search bar -->
    <div class="search-container">
      <input
        type="text"
        id="searchInput"
        placeholder="Search products by name or category..."
        class="search-input"
      />
    </div>

    <main class="products-section">
      <% if (products.length === 0) { %>
      <p class="no-products">No products available right now üçÉ</p>
      <% } else { %>
      <div class="product-wrapper">
        <% products.forEach(product => { %>
        <div class="product-tile">
          <div class="product-img">
            <img src="<%= product.image %>" alt="<%= product.name %>" />
          </div>

          <div class="product-body">
            <h2 class="product-name"><%= product.name %></h2>
            <p class="product-category"><%= product.category %></p>

            <div class="product-details">
              <span class="product-price"
                >$<%= product.price.toFixed(2) %> / kg</span
              >
              <span class="product-stock"
                >Available: <%= product.quantity %> kg</span
              >
            </div>

            <p class="product-desc"><%= product.description %></p>

            <form class="product-buy" action="/cart/add" method="POST">
              <input type="hidden" name="productId" value="<%= product._id %>">
              <label for="kg-<%= product._id %>">Select kg:</label>
              <input
                type="number"
                id="kg-<%= product._id %>"
                name="quantity"
                min="0.1"
                max="<%= product.quantity %>"
                step="0.1"
                value="1"
                class="quantity-input"
              />
              <button class="add-btn">
                <i class="fa-solid fa-cart-plus"></i> Add to Cart
              </button>
            </form>
          </div>
        </div>
        <% }) %>
      </div>
      <% } %>
    </main>

    <%- include('../partials/footer.ejs') %>

    <!-- üîç Search logic -->
    <script>
      const searchInput = document.getElementById("searchInput");
      const productTiles = document.querySelectorAll(".product-tile");

      searchInput.addEventListener("input", function (e) {
        const query = e.target.value.toLowerCase().trim();

        productTiles.forEach((tile) => {
          const name = tile.querySelector(".product-name").textContent.toLowerCase();
          const category = tile.querySelector(".product-category").textContent.toLowerCase();

          if (name.includes(query) || category.includes(query)) {
            tile.style.display = "";
          } else {
            tile.style.display = "none";
          }
        });
      });
    </script>
  </body>
</html>
